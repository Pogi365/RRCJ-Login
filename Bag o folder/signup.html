<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign Up | eSumbong</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
  /* your existing CSS here */
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
  body { background: rgb(10, 1, 45); height: 100vh; display: flex; justify-content: center; align-items: center; }
  .container { width: 360px; background: #fff; padding: 35px 30px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); animation: fadeIn 0.6s ease; }
  @keyframes fadeIn { from {opacity: 0; transform: translateY(20px);} to {opacity: 1; transform: translateY(0);} }
  h2 { text-align: center; margin-bottom: 20px; font-weight: 600; color: #333; }
  input { width: 100%; padding: 12px; margin-top: 13px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; transition: 0.2s; }
  input:focus { border-color: #0062ff; outline: none; box-shadow: 0 0 3px rgba(0,98,255,0.4); }
  .password-wrapper { position: relative; }
  .toggle-eye { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 17px; }
  button { width: 100%; padding: 12px; margin-top: 20px; border: none; background: #0062ff; color: white; border-radius: 8px; font-size: 15px; cursor: pointer; font-weight: 500; transition: 0.25s; }
  button:hover { background: #004ccd; }
  p { text-align: center; margin-top: 15px; font-size: 14px; }
  a { color: #0062ff; text-decoration: none; font-weight: 500; }
  a:hover { text-decoration: underline; }
</style>

</head>
<body>

<div class="container">
  <form id="signup-form">
    <h2>Create Account</h2>

    <input type="text" id="name" placeholder="Full Name" required>
    <input type="email" id="email" placeholder="Email Address" required>

    <div class="password-wrapper">
      <input type="password" id="password" placeholder="Password" required>
      <span id="toggle-password" class="toggle-eye">üëÅÔ∏è</span>
    </div>

    <div class="password-wrapper">
      <input type="password" id="confirm-password" placeholder="Confirm Password" required>
      <span id="toggle-confirm" class="toggle-eye">üëÅÔ∏è</span>
    </div>

    <button type="submit">Sign Up</button>
    <p>Already have an account? <a href="index.html">Login here</a></p>
  </form>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAxSVskTjLNwTIKYJoYJiSffY26dqK0qTE",
    authDomain: "loginsystem-40c09.firebaseapp.com",
    projectId: "loginsystem-40c09",
    storageBucket: "loginsystem-40c09.appspot.com",
    messagingSenderId: "307095420846",
    appId: "1:307095420846:web:21682791cdf36fae2c923f"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Toggle visibility
  document.getElementById("toggle-password").onclick = () => {
    const p = document.getElementById("password");
    p.type = p.type === "password" ? "text" : "password";
  };
  document.getElementById("toggle-confirm").onclick = () => {
    const cp = document.getElementById("confirm-password");
    cp.type = cp.type === "password" ? "text" : "password";
  };

  // Sign-up process
  document.getElementById("signup-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirm-password").value;

    if(password !== confirmPassword){
      alert("Passwords do not match!");
      return;
    }
    if(password.length < 6){
      alert("Password must be at least 6 characters!");
      return;
    }
    const complexity = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/;
    if(!complexity.test(password)){
      alert("Password must contain uppercase, lowercase, and a number.");
      return;
    }

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      await setDoc(doc(db, "users", user.uid), {
        name,
        email,
        createdAt: new Date(),
        verified: false
      });

      // Send verification email
      await sendEmailVerification(user);
      alert("Account created! Check your email for verification.\nWait for verification.");

      // Redirect to login page
      window.location.href = "index.html";

    } catch(err) {
      if(err.code === "auth/email-already-in-use"){
        alert("Email already registered. Try logging in.");
      } else {
        alert(err.message);
      }
    }
  });
</script>

</body>
</html>
